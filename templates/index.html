<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
  <meta charset="UTF-8">
  <title>Love Locks</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <style>
    @keyframes drop-lock {
      0% {
        transform: translateY(-200px) rotate(-15deg);
        opacity: 0;
      }
      100% {
        transform: translateY(0) rotate(0);
        opacity: 1;
      }
    }

    .lock-svg-preview {
      margin-top: 30px;
      padding: 10px;
      border-radius: 20px;
      background-color: rgba(255,255,255,0.7);
      display: inline-block;
    }

    .lock-svg-preview object {
      animation: drop-lock 0.8s ease-out;
    }
  </style>
</head>
<body>
  <div class="lang-switch">
    <a href="{{ url_for('set_lang', lang='en') }}">ğŸ‡ºğŸ‡¸ English</a> |
    <a href="{{ url_for('set_lang', lang='ko') }}">ğŸ‡°ğŸ‡· í•œêµ­ì–´</a>
  </div>

  <div class="container">
    <h1 id="title">â¤ï¸</h1>

    <form action="{{ url_for('create_lock') }}" method="post">
      <input type="text" name="name1" id="name1" placeholder="Name 1" required />
      <input type="text" name="name2" id="name2" placeholder="Name 2" required />
      <br />
      <textarea name="message" id="message" placeholder="Optional message" rows="3"></textarea>
      <br />
      <button type="submit" id="lock-btn">ğŸ” Lock it!</button>
    </form>

    <!-- ğŸ” ìë¬¼ì‡  SVG ë¯¸ë¦¬ë³´ê¸° -->
    <div class="lock-svg-preview">
      <object type="image/svg+xml" id="svgLock" width="160" height="200"></object>
    </div>
  </div>

  <script>
    // ë‹¤êµ­ì–´ í…ìŠ¤íŠ¸ ì ìš©
    fetch(`/locales/{{ lang }}.json`)
      .then(res => res.json())
      .then(data => {
        document.getElementById('title').innerText = data['title'];
        document.getElementById('name1').placeholder = data['name1'];
        document.getElementById('name2').placeholder = data['name2'];
        document.getElementById('message').placeholder = data['message'];
        document.getElementById('lock-btn').innerText = data['submit'];
      });

    // ëœë¤ ìë¬¼ì‡  ìƒ‰ìƒ ì„ íƒ
    const colors = ['red', 'yellow', 'blue'];
    const randomColor = colors[Math.floor(Math.random() * colors.length)];
    const svgLock = document.getElementById('svgLock');
    svgLock.data = `/static/img/lock_${randomColor}.svg`;

    // ì´ë¦„ ì…ë ¥ ì‹œ ìë¬¼ì‡  SVG ì•ˆì— í…ìŠ¤íŠ¸ ë°˜ì˜
    document.getElementById('name1').addEventListener('input', updatePreview);
    document.getElementById('name2').addEventListener('input', updatePreview);

    function updatePreview() {
      const name1 = document.getElementById('name1').value.trim();
      const name2 = document.getElementById('name2').value.trim();
      const previewText = name1 && name2 ? `${name1} â¤ï¸ ${name2}` : 'â¤ï¸';

      if (svgLock && svgLock.contentDocument) {
        const textElement = svgLock.contentDocument.getElementById('lockText');
        if (textElement) {
          textElement.textContent = previewText;
        }
      }
    }

    // SVG ë¡œë“œ ì™„ë£Œ í›„ ì²« ë¯¸ë¦¬ë³´ê¸° ë°˜ì˜
    svgLock.addEventListener("load", updatePreview);
  </script>
</body>
</html>
